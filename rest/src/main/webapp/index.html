<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>EasyHome Test Page</title>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.1/themes/vader/jquery-ui.css" />
<style>
   .eh_button { padding: 0.8em; margin: 1em; background: #666666; }
   .selection_button { height: 250px; width: 250px; color: #36609f; }
   #eh_help_button { height: 125px; width: 125px; color: #eb7914; }
   .arrow_button { height: 100px; width: 100px; color: #61c165; }
   .navigation_button { height: 125px; width: 125px; color: #61c165; }
   .yellow { color: #e0c73d; }
   .green { color: #61c165; }
   .blue { color: #36609f; }
   .red { color: #e75c5c; }
   .orange { color: #eb7914; }
   #eh_selection_buttons_container { position: absolute; left: 12px; bottom: 15px; }
   #eh_selection_buttons_container div { float: left; }

   #eh_help_button_container { position: absolute; right: 15px; top: 15px; }

   #eh_navigation_buttons_container { position: absolute; left: 15px; top: 15px; }
   #eh_navigation_buttons_container div { float: left; }

   .eh_arrow_button_positioner { position: relative; top: 75px; }
   
   div.text { font-family:"Verdana"; font-size: 40pt; text-transform: uppercase; text-align: center; font-weight: bold; padding: 0.3em; } 
   #eh_description_float {position: absolute; left: 80px; top: 290px; }
   #eh_description_div { border-width: 1px; width: 1070px; border-style: solid; border-color: #666666; color: #ffffff; }
   
}
</style>

<script src="js/jquery-1.9.1.js"></script>
<script src="js/jquery-ui-1.10.2.custom.js"></script>
<script type='text/javascript'>

var roomsLoaded = false;

var hoverTimeout;
var hoverEffectTime = 1000;
var helpSelected = false;
var helpText = "";
var currentLeftIndex = 0;

var homeRooms;
var roomDevices;
var deviceFunctionalities;

var uiState = {Home: 1, Room: 2, Device: 3, Functionality: 4};

var currentState;
var currentRoom;
var currentDevice;
var currentFunctionality;

var lowSelectionIndex;

function arrowHoverEffectIn(button) {
    button.stop().animate({
          backgroundColor: button.css('color')
            }, hoverEffectTime );
            
    hoverTimeoutFunc = function() {
    
      if (button.attr('id') == "eh_arrow_left") {
      		lowSelectionIndex--;
      } else {
      		lowSelectionIndex++;
      }              
      
      switch(currentState) {

		case uiState.Home:
			showSelections(homeRooms);  	
			break;
				
		case uiState.Room:
			showSelections(roomDevices);
			break;        
      }    
      
      if (button.css('visibility') == 'visible')
        hoverTimeout = setTimeout(hoverTimeoutFunc, hoverEffectTime); 
    
    };

    hoverTimeout = setTimeout(hoverTimeoutFunc, hoverEffectTime);
}

function selectionButtonHoverEffectIn(button) {
    button.stop().animate({
          backgroundColor: button.css('color')
            }, hoverEffectTime
    );

    hoverTimeout = setTimeout(function(){   
    
    		var idx = button.find('img').attr('id');    
        
            switch (currentState) {
    
    			case uiState.Home:
    				selectRoom(homeRooms[idx]);
    				break;
    			case uiState.Room:
    				selectDevice(roomDevices[idx]);
    				break;
    			case uiState.Device:
    				selectFunctionality(deviceFunctionalities[idx]);
    			    // Functionalities have no selection buttons, only actuators
    		}
            
            button.stop().css('backgroundColor', "#666666");
        
        }, hoverEffectTime
    );
}

function navigationButtonHoverEffectIn(button) {

    var isDifferentState;
    
    switch (button.attr('id')) {

		case 'eh_nav_home':
			isDifferentState =  (currentState != uiState.Home);
			break;
		case 'eh_nav_room':
			isDifferentState =  (currentState != uiState.Room);
			break;
		case 'eh_nav_device':
		    isDifferentState = (currentState != uiState.Device);
			break;
		case 'eh_nav_functionality':
			isDifferentState = false;
	}      
			    
	if (isDifferentState) {
    
	    button.stop().animate({
	        backgroundColor: button.css('color')
	          }, hoverEffectTime );
	
	    hoverTimeout = setTimeout(function(){ 
	              
    	       switch (button.attr('id')) {
    	
    				case 'eh_nav_home':
    					selectState(uiState.Home);
    					break;
    				case 'eh_nav_room':										
    				    selectState(uiState.Room);
    					break;
    				case 'eh_nav_device':
    				    selectState(uiState.Device);
    					break;
    				default:
    		   }                  
    	       
    	       button.stop().css('backgroundColor', "#666666");
	
	       }, hoverEffectTime
	   );
         
    }
}

function buttonHoverEffectOut(button) {
    clearTimeout(hoverTimeout);
    button.stop().animate({backgroundColor: "#666666"}, hoverEffectTime/2 );
}

function helpHoverEffectIn() {
    var button = $("#eh_help_button");

    if (!helpSelected) {
        button.stop().animate({
              backgroundColor: button.css('color')
                }, hoverEffectTime );

        hoverTimeout = setTimeout(function(){ 
	        	   helpSelected = true;
	        	   if (currentState != uiState.Functionality)
	        		   $("#eh_selection_buttons_container").hide();
	        	   else
	        		   $("#eh_functionality_container").hide();
	               $("#eh_description_div").text(helpText).show();                                
             },hoverEffectTime
        );
    } else {
        
        button.stop().animate({
              backgroundColor: "#666666"
                }, hoverEffectTime );

        hoverTimeout = setTimeout(function(){
	        	helpSelected = false;
                if (currentState != uiState.Functionality)
                    $("#eh_selection_buttons_container").show();
                else
                    $("#eh_functionality_container").show();  
	            $("#eh_description_div").hide();                                
            },hoverEffectTime
        );
    }
}

function helpHoverEffectOut() {

    var button = $("#eh_help_button");

    clearTimeout(hoverTimeout);
    
    if (!helpSelected) {
        button.stop().animate({backgroundColor: "#666666"}, hoverEffectTime/2 );
    } else {
        button.stop().animate({backgroundColor: button.css('color')}, hoverEffectTime/2 );  
    }
}

function selectRoom(room) {

   currentRoom = room;
   var roomId = room.id;
   $("#eh_nav_room").find('img').attr('src',room.imgPath).attr('alt',room.name);

   $.ajax({ 
       type: "GET",
       dataType: "json",
       url: "http://localhost:8080/easyhome/rest/devices/?locationId="+roomId,
       success: function(data){        
          roomDevices = data;
          lowSelectionIndex = 0;
											
          selectState(uiState.Room);
       },
       error: function(jqXHR, textStatus, errorThrown){
          alert(textStatus + ":" + errorThrown);
       }
   });	  
}

function selectDevice(device) {

   currentDevice = device;
   var deviceId = device.id;
   $("#eh_nav_device").find('img').attr('src',device.imgPath).attr('alt',device.name);
  
   $.ajax({ 
       type: "GET",
       dataType: "json",
       url: "http://localhost:8080/easyhome/rest/functionalities/?deviceId="+deviceId,
       success: function(data){        
          deviceFunctionalities = data;
          lowSelectionIndex = 0;
                                            
          selectState(uiState.Device);
       },
       error: function(jqXHR, textStatus, errorThrown){
          alert(textStatus + ":" + errorThrown);
       }
   });    
}

function selectFunctionality(functionality) {

   currentFunctionality = functionality;
   $("#eh_nav_functionality").find('img').attr('src',functionality.imgPath).attr('alt',functionality.name); 
   selectState(uiState.Functionality);
}

function initialize() {

  lowSelectionIndex = 0;
  currentState = uiState.Room;

  getHomeRoomsPeriodically(true);
}

function getHomeRoomsPeriodically(isEntryPoint) {

   $.ajax({ 
       type: "GET",
       dataType: "json",
       url: "http://localhost:8080/easyhome/rest/locations",
       success: function(data){        
          homeRooms = data;

          if (isEntryPoint)
        	  selectState(uiState.Home);
          else if (currentState == uiState.Home)
              showSelections(homeRooms);
        	  
          setTimeout(function() { getHomeRoomsPeriodically(false); },500);
       }
   });	
	
}

function selectState(newState) {

  currentState = newState;
  lowSelectionIndex = 0;

  $("#eh_description_div").hide();
  $("#eh_help_button").css('backgroundColor','#666666');
  updateHelpText(currentState);
  
  switch (newState) {
  
    case uiState.Home:
    													
    	$("#eh_nav_room,#eh_nav_device,#eh_nav_functionality").hide();
    	$("#eh_functionality_container").hide();
    	$("#eh_selection_buttons_container").show();
		showSelections(homeRooms);
		break;  
  
    case uiState.Room:
				
	    $("#eh_nav_room").show();
		$("#eh_nav_device,#eh_nav_functionality").hide();
		$("#eh_functionality_container").hide();
		$("#eh_selection_buttons_container").show();
	    showSelections(roomDevices);
		break;
							
    case uiState.Device:
				
	    $("#eh_nav_room,#eh_nav_device").show();
		$("#eh_nav_functionality").hide();			
		$("#eh_functionality_container").hide();
		$("#eh_selection_buttons_container").show();
	    showSelections(deviceFunctionalities);
		  
		break;
						
	case uiState.Functionality:  
				
		$("#eh_nav_room,#eh_nav_device,#eh_nav_functionality").show();
		$("#eh_selection_buttons_container").hide();
		showFunctionality(currentFunctionality);
		$("#eh_functionality_container").show();
  }
}

function updateHelpText(currentState) {

  switch (currentState) {
  
	case uiState.Home:
		
		helpText = "Seleziona una stanza per accedere ai dispositivi presenti";
		break;
				
	case uiState.Room:
		
		helpText = "Seleziona un dispositivo per accedere alle funzionalitÃ  disponibili";
		break;
				
	case uiState.Device:
		
		helpText = currentDevice.help;
		break;
				
	case uiState.Functionality:  

		helpText = currentFunctionality.help;
  }

}

function getAltMessage(selection) {
	
    var altString = selection.name;
    
    switch (currentState) {
    
        case uiState.Home:
        	
        	if (selection.occupied)
                altString += " (occupata)";
            break;
            
        default:
    
    }
    
	return altString;
}

function showSelections(selections) {

  	var firstSelection, secondSelection, thirdSelection;

	if (lowSelectionIndex == 0)
		$("#eh_arrow_left").css('visibility','hidden');
	else  			
		$("#eh_arrow_left").css('visibility','visible');
	if (lowSelectionIndex+2 >=selections.length-1)
		$("#eh_arrow_right").css('visibility','hidden');
	else
		$("#eh_arrow_right").css('visibility','visible');
		  
	switch (selections.length) {
	
	  case 0:  
		  $(".selection_button").each( function() {
				$(this).css('visibility','hidden');
		  });		  
	  	  break;
	  			
	  case 1:
		  $("#eh_selection_left,#eh_selection_right").each( function() {
				$(this).css('visibility','hidden');
		  });
		  var button = $("#eh_selection_center");
		  button.css('visibility','visible');
		  var loc = selections[0];
	  	  button.find('img').attr('id',0).attr('alt',getAltMessage(loc)).attr('src',loc.imgPath);
	  	  break;
	  			
	  case 2:
		  
		  $("#eh_selection_center").css('visibility','hidden');

		  $("#eh_selection_left,#eh_selection_right").each( function() {
			    $(this).css('visibility','visible');		
		  });
					
		  var button = $("#eh_selection_left");
		  var loc = selections[0];
	  	  button.find('img').attr('id',0).attr('alt',getAltMessage(loc)).attr('src',loc.imgPath);						
					
		  button = $("#eh_selection_right");
		  var loc = selections[1];
	  	  button.find('img').attr('id',1).attr('alt',getAltMessage(loc)).attr('src',loc.imgPath);
	      break;		  	
							  	
	  default:
		  
		  $(".selection_button").each( function() {
				$(this).css('visibility','visible');
		  });	
					
		  var button = $("#eh_selection_left");
		  var loc = selections[lowSelectionIndex];
	  	  button.find('img').attr('id',lowSelectionIndex).attr('alt',getAltMessage(loc)).attr('src',loc.imgPath);						
					
		  button = $("#eh_selection_center");
		  var loc = selections[lowSelectionIndex+1];
	  	  button.find('img').attr('id',lowSelectionIndex+1).attr('alt',getAltMessage(loc)).attr('src',loc.imgPath);
	  	  	
		  button = $("#eh_selection_right");
		  var loc = selections[lowSelectionIndex+2];
	  	  button.find('img').attr('id',lowSelectionIndex+2).attr('alt',getAltMessage(loc)).attr('src',loc.imgPath);
	  	  			  	  	
	  	  break;
	}
}

function showFunctionality(functionality) {
	
    switch (functionality.type) {
    
    case 'LUMINOSITY_CONTROL':
    	
    	break;
    	
    case 'COLOR_CONTROL':
    	
        break;
        
    case 'PAIRING':
    	
    	break;
    }
}

$(document).ready(function(){

initialize();

$("#eh_description_div").hide();

$(".eh_button").each(
    function() {
        var img = $(this).find("img");

        img.css('height',$(this).css('height'));
        img.css('width',$(this).css('height'));
    }
);

$(".selection_button").hover(
    function() {
    	if (!helpSelected)
          $("#eh_description_div").text($(this).find("img").attr("alt")).show();
        selectionButtonHoverEffectIn($(this));
    }
    ,
    function() {
        if (!helpSelected)
          $("#eh_description_div").hide();
        buttonHoverEffectOut($(this));
    }
);

$(".navigation_button").hover(
    function() {
    	if (!helpSelected)
          $("#eh_description_div").text($(this).find("img").attr("alt")).show();
        navigationButtonHoverEffectIn($(this));
    }
    ,
    function() {
        if (!helpSelected)
          $("#eh_description_div").hide();
        buttonHoverEffectOut($(this));
    }
);

$("#eh_help_button").hover(
    function() {
		if (!helpSelected)
          $("#eh_description_div").text($(this).find("img").attr("alt")).show();
        helpHoverEffectIn();
    }
    ,
    function() {
    	if (!helpSelected)
        	 $("#eh_description_div").hide();
        helpHoverEffectOut();
    }
);

$(".arrow_button").hover(
    function() {
        arrowHoverEffectIn($(this));
    }
    ,
    function() {
        buttonHoverEffectOut($(this));
    }
);

});

</script>
</head>

<body bgcolor="black">

  <div id="eh_navigation_buttons_container">

      <div id="eh_nav_home" class="eh_button navigation_button ui-widget-content ui-corner-all">
        <img src="img/home.svg" alt="Selezione stanza"/>
      </div>
      <div id="eh_nav_room" class="eh_button navigation_button ui-widget-content ui-corner-all">
        <img />
      </div>
      <div id="eh_nav_device" class="eh_button navigation_button ui-widget-content ui-corner-all">
        <img />
      </div>
      <div id="eh_nav_functionality" class="eh_button navigation_button ui-widget-content ui-corner-all">
        <img />
      </div>
  </div>

  <div id="eh_help_button_container">
    <div id="eh_help_button" class="eh_button ui-widget-content ui-corner-all">
      <img src="img/help.svg" alt="Aiuto contestuale"/>
    </div>
  </div>

  <div id="eh_description_float">
      <div id="eh_description_div" class="ui-corner-all text"></div>
  </div>
 
  <div id="eh_selection_buttons_container">

      <div class="eh_arrow_button_positioner">
        <div id="eh_arrow_left" class="eh_button arrow_button ui-widget-content ui-corner-all">
          <img src="img/arrowleft.svg"/>
        </div>
      </div>
	
	  <div id="eh_selection_left" class="eh_button selection_button ui-widget-content ui-corner-all">
	    <img />
	  </div>
		      
	  <div id="eh_selection_center" class="eh_button selection_button ui-widget-content ui-corner-all">
		<img />
	  </div>
		      
	  <div id="eh_selection_right" class="eh_button selection_button ui-widget-content ui-corner-all">
		<img />
	  </div>

      <div class="eh_arrow_button_positioner">
		<div id="eh_arrow_right" class="eh_button arrow_button ui-widget-content ui-corner-all">
			<img src="img/arrowright.svg"/>
	    </div>
      </div>
  </div>
  
  <div id="eh_functionality_container"></div>

</body>
</html>
